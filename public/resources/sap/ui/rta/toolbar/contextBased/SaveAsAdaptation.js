/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/base/Log","sap/base/strings/formatMessage","sap/ui/core/Fragment","sap/ui/core/library","sap/ui/fl/Layer","sap/ui/fl/write/api/ContextBasedAdaptationsAPI","sap/ui/fl/write/api/ContextSharingAPI","sap/ui/rta/Utils","sap/ui/model/Binding","sap/ui/model/json/JSONModel"],function(t,e,o,a,i,n,s,r,l,d,p){"use strict";var h=i.ValueState;var c=t.extend("sap.ui.rta.toolbar.contextBased.SaveAsAdaptation",{metadata:{properties:{toolbar:{type:"any"}}},constructor:function(){t.prototype.constructor.apply(this,arguments);this.oTextResources=this.getToolbar().getTextResources()}});c.prototype.openAddAdaptationDialog=function(t){if(!this._oAddAdaptationDialogPromise){this._oAddAdaptationDialogPromise=a.load({name:"sap.ui.rta.toolbar.contextBased.SaveAsAdaptationDialog",id:this.getToolbar().getId()+"_fragment--sapUiRta_addAdaptationDialog",controller:{onAdaptationTitleChange:A.bind(this),onSaveAsAdaptation:T.bind(this),onCancelAdaptationDialog:C.bind(this),onPriorityChange:_.bind(this)}}).then(function(t){this._oAddAdaptationDialog=t;this._oAddAdaptationDialog.attachBeforeClose(b.bind(this));t.addStyleClass(l.getRtaStyleClassName());this.getToolbar().addDependent(this._oAddAdaptationDialog)}.bind(this))}else{this.getToolbar().getControl("addAdaptationDialog--saveAdaptation-title-input").setValue("")}return this._oAddAdaptationDialogPromise.then(function(){return f.call(this,t)}.bind(this)).then(function(){var t=this.getToolbar().getRtaInformation();this.oAdaptationsModel=s.getAdaptationsModel({control:t.rootControl,layer:t.flexSettings.layer});return g.call(this)}.bind(this))};function g(){u.call(this,this.oAdaptationsModel.getProperty("/adaptations"));return this._oAddAdaptationDialog.open()}function u(t){var e=[{key:0,title:this.oTextResources.getText("TXT_SELECT_FIRST_PRIO")}];var a=this.oTextResources.getText("TXT_SELECT_PRIO");t.forEach(function(t,i){e.push({key:(i+1).toString(),title:o(a,[t.title,i+2])})});this.oPrioritySelectionModel=new p({selected:this.oTextResources.getText("TXT_SELECT_FIRST_PRIO"),priority:e});this._oAddAdaptationDialog.setModel(this.oPrioritySelectionModel,"prioritySelectionModel")}function A(){m.call(this)}function C(){this._oAddAdaptationDialog.close()}function T(){var t={};t.title=S.call(this);t.contexts=this._oContextComponentInstance.getSelectedContexts();t.priority=R.call(this);var o=this.getToolbar().getRtaInformation();s.create({control:o.rootControl,layer:o.flexSettings.layer,contextBasedAdaptation:t}).catch(function(t){e.error(t.stack);var o="MSG_LREP_TRANSFER_ERROR";var a={titleKey:"SAC_DIALOG_HEADER"};a.details=t.userMessage;l.showMessageBox("error",o,a)});this._oAddAdaptationDialog.close()}function _(t){this.sPriority=t.getParameters().selectedItem.getProperty("key")}function x(){if(this._oAddAdaptationDialog&&this._oAddAdaptationDialog.isOpen()){var t=this.getToolbar().getControl("addAdaptationDialog--saveAdaptation-title-input");var e=t.getValue().trim().length;var o=100;if(e===0){t.setValueState(h.Error);t.setValueStateText(this.oTextResources.getText("TXT_CTX_ERROR_EMPTY_TITLE"))}else if(e>o){t.setValueState(h.Error);t.setValueStateText(this.oTextResources.getText("TXT_CTX_ERROR_MAX_LEN",[o]))}else if(e>0){var a=this.oAdaptationsModel.getProperty("/adaptations").findIndex(function(e){if(e.title.trim().toLowerCase()===t.getValue().trim().toLowerCase()){return true}return false});if(a>-1){t.setValueState(h.Error);t.setValueStateText(this.oTextResources.getText("TXT_CTX_ERROR_DUPLICATE_TITLE"))}else{t.setValueState(h.None);t.setValueStateText(null)}}}}function f(t){var e={layer:t||n.CUSTOMER};return r.createComponent(e).then(function(t){this._oContextComponent=t;this._oContextComponentInstance=t.getComponentInstance();this._oContextComponentInstance.resetSelectedContexts();this._oAddAdaptationDialog.addContent(this._oContextComponent);var e=this._oContextComponentInstance.getSelectedContextsModel();this.oSelectedContextsBinding=new d(e,"/",e.getContext("/"));this.oSelectedContextsBinding.attachChange(m.bind(this));this._oContextComponentInstance.showMessageStrip(false)}.bind(this))}function S(){var t=this.getToolbar().getControl("addAdaptationDialog--saveAdaptation-title-input");return t?t.getValue().trim():""}function R(){return Number(this.sPriority)||0}function m(){x.call(this);var t=this.getToolbar().getControl("addAdaptationDialog--saveAdaptation-title-input");var e=t.getValueState()===h.None&&this._oContextComponentInstance.getSelectedContexts().role.length>0;this.getToolbar().getControl("addAdaptationDialog--saveAdaptation-saveButton").setEnabled(e)}function b(){if(this._oContextComponentInstance){this._oContextComponentInstance.showMessageStrip(true);this._oContextComponentInstance.resetSelectedContexts()}}return c});
//# sourceMappingURL=SaveAsAdaptation.js.map