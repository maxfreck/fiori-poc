/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Fragment","sap/ui/core/Popup","sap/ui/fl/write/api/Version","sap/ui/rta/toolbar/contextBased/SaveAsAdaptation","sap/ui/rta/toolbar/contextBased/ManageAdaptations","sap/ui/rta/toolbar/translation/Translation","sap/ui/rta/toolbar/versioning/Versioning","sap/ui/rta/appVariant/Feature","sap/ui/rta/toolbar/Base","sap/ui/rta/Utils","./AdaptationRenderer"],function(t,i,e,o,n,s,r,a,h,c,d){"use strict";var l=h.extend("sap.ui.rta.toolbar.Adaptation",{renderer:d,animation:true,metadata:{library:"sap.ui.rta",events:{undo:{},redo:{},exit:{},save:{},restore:{},publishVersion:{},modeChange:{},activate:{},discardDraft:{},switchVersion:{},openChangeCategorySelectionPopover:{}}}});l.LEFT_SECTION="toolbarIconAndDraftSection";l.MIDDLE_SECTION="toolbarSwitcherSection";l.RIGHT_SECTION="toolbarActionsSection";var u=124;l.prototype.init=function(){this._mSizeLimits={switchToIcons:undefined};this._pFragmentLoaded=h.prototype.init.apply(this,arguments).then(function(){this._onResize=this._onResize.bind(this);window.addEventListener("resize",this._onResize);this._aIntersectionObservers=[]}.bind(this))};l.prototype._calculateWindowWidth=function(t){var i=t[0].intersectionRect.width;return i*2+this._iSwitcherToolbarWidth+80};l.prototype.onFragmentLoaded=function(){return this._pFragmentLoaded};l.prototype.exit=function(){window.removeEventListener("resize",this._onResize);this._aIntersectionObservers.forEach(function(t){t.disconnect()});h.prototype.exit.apply(this,arguments)};l.prototype._restoreHiddenElements=function(){delete this._iOnResizeAnimationFrame;if(window.innerWidth>this._mSizeLimits.switchToIcons){this._switchToTexts();delete this._mSizeLimits.switchToIcons}};l.prototype._onResize=function(){if(this._iOnResizeAnimationFrame){window.cancelAnimationFrame(this._iOnResizeAnimationFrame)}this._iOnResizeAnimationFrame=window.requestAnimationFrame(this._restoreHiddenElements.bind(this))};l.prototype.initialAdjustToolbarSectionWidths=function(){var t=this.getControl("modeSwitcher").getDomRef().getBoundingClientRect().width;this._iSwitcherToolbarWidthWithTexts=t+16;this._iSwitcherToolbarWidth=this._iSwitcherToolbarWidthWithTexts;this.adjustToolbarSectionWidths()};l.prototype.adjustToolbarSectionWidths=function(){this.getControl(l.MIDDLE_SECTION).setWidth(this._iSwitcherToolbarWidth+"px");[l.LEFT_SECTION,l.RIGHT_SECTION].forEach(function(t){this.getControl(t).getDomRef().style.setProperty("width","calc(50% - "+Math.ceil(this._iSwitcherToolbarWidth/2)+"px)","important")}.bind(this))};l.prototype._observeIntersections=function(){this._aIntersectionObservers.forEach(function(t){t.disconnect()});[l.LEFT_SECTION,l.RIGHT_SECTION].forEach(function(t){var i=this._createIntersectionObserver(t);this._observeToolbarIntersection(t,i);this._aIntersectionObservers.push(i)}.bind(this))};l.prototype._hideElementsOnIntersection=function(t,i){if(i[0].intersectionRatio===0){this.adjustToolbarSectionWidths();this._observeIntersections();return}if(i[0].intersectionRatio<1){if(!this._mSizeLimits.switchToIcons){this._mSizeLimits.switchToIcons=this._calculateWindowWidth(i);this._switchToIcons()}}};l.prototype._createIntersectionObserver=function(t){return new IntersectionObserver(this._hideElementsOnIntersection.bind(this,t),{threshold:1,root:this.getControl(t).getDomRef()})};l.prototype._observeToolbarIntersection=function(t,i){var e=this.getControl(t);e.getItems().map(function(t){var e=t.getDomRef();i.observe(e)})};l.prototype.show=function(){return h.prototype.show.call(this,this.initialAdjustToolbarSectionWidths.bind(this)).then(function(){this._observeIntersections()}.bind(this))};function p(t,i,e,o){var n=this.getControl(t);var s=e?this.getTextResources().getText(e):"";var r=o?this.getTextResources().getText(o):"";n.setText(s||"");n.setTooltip(r||"");n.setIcon(i||"")}l.prototype.formatPublishVersionVisibility=function(t,i,e,o){return this.getExtension("versioning",r).formatPublishVersionVisibility(t,i,e,o)};l.prototype.formatDiscardDraftVisible=function(t,i,e){return this.getExtension("versioning",r).formatDiscardDraftVisible(t,i,e)};l.prototype.formatVersionButtonText=function(t,i){return this.getExtension("versioning",r).formatVersionButtonText(t,i)};l.prototype.showVersionHistory=function(t){return this.getExtension("versioning",r).showVersionHistory(t)};l.prototype._openVersionTitleDialog=function(t){return this.getExtension("versioning",r).openActivateVersionDialog(t)};l.prototype.showActionsMenu=function(e){var o=e.getSource();if(!this._oActionsMenuFragment){return t.load({id:this.getId()+"_actionsMenu_fragment",name:"sap.ui.rta.toolbar.ActionsMenu",controller:{openDownloadTranslationDialog:f.bind(this),openUploadTranslationDialog:b.bind(this),manageApps:I.bind(this),overviewForKeyUser:v.bind(this),overviewForDeveloper:w.bind(this),restore:this.eventHandler.bind(this,"Restore"),formatSaveAsEnabled:g,saveAs:T.bind(this)}}).then(function(t){t.addStyleClass(c.getRtaStyleClassName());this.addDependent(t);t.openBy(o,true,i.Dock.CenterTop,i.Dock.CenterBottom);this._oActionsMenuFragment=t}.bind(this))}this._oActionsMenuFragment.openBy(o,true,i.Dock.CenterTop,i.Dock.CenterBottom);return Promise.resolve()};l.prototype._showButtonIcon=function(t,i,e){p.call(this,t,i,"",e)};l.prototype._showButtonText=function(t,i){p.call(this,t,"",i,"")};l.prototype._switchToIcons=function(){this._showButtonIcon("adaptationSwitcherButton","sap-icon://wrench","BTN_ADAPTATION");this._showButtonIcon("navigationSwitcherButton","sap-icon://explorer","BTN_NAVIGATION");this._showButtonIcon("visualizationSwitcherButton","sap-icon://show","BTN_VISUALIZATION");this._iSwitcherToolbarWidth=u;this.adjustToolbarSectionWidths()};l.prototype._switchToTexts=function(){this._showButtonText("adaptationSwitcherButton","BTN_ADAPTATION");this._showButtonText("navigationSwitcherButton","BTN_NAVIGATION");this._showButtonText("visualizationSwitcherButton","BTN_VISUALIZATION");this._iSwitcherToolbarWidth=this._iSwitcherToolbarWidthWithTexts;this.adjustToolbarSectionWidths()};l.prototype.buildControls=function(){return t.load({name:"sap.ui.rta.toolbar.Adaptation",id:this.getId()+"_fragment",controller:{activate:this._openVersionTitleDialog.bind(this),discardDraft:this.eventHandler.bind(this,"DiscardDraft"),formatDiscardDraftVisible:this.formatDiscardDraftVisible.bind(this),formatPublishVersionVisibility:this.formatPublishVersionVisibility.bind(this),modeChange:this.eventHandler.bind(this,"ModeChange"),undo:this.eventHandler.bind(this,"Undo"),redo:this.eventHandler.bind(this,"Redo"),openChangeCategorySelectionPopover:this.eventHandler.bind(this,"OpenChangeCategorySelectionPopover"),saveAsAdaptation:_.bind(this),manageAdaptations:m.bind(this),publishVersion:this.eventHandler.bind(this,"PublishVersion"),save:this.eventHandler.bind(this,"Save"),exit:this.eventHandler.bind(this,"Exit"),formatVersionButtonText:this.formatVersionButtonText.bind(this),showVersionHistory:this.showVersionHistory.bind(this),showActionsMenu:this.showActionsMenu.bind(this)}})};function f(){var t={layer:this.getRtaInformation().flexSettings.layer,selector:this.getRtaInformation().rootControl};this.getExtension("translation",s).openDownloadTranslationDialog(t)}function b(){this.getExtension("translation",s).openUploadTranslationDialog()}function g(t,i){return t&&i!==e.Number.Draft}function T(){a.onSaveAs(true,true,this.getRtaInformation().flexSettings.layer,null)}function _(){this.getExtension("contextBasedSaveAs",o).openAddAdaptationDialog(this.getRtaInformation().flexSettings.layer)}function m(){this.getExtension("contextBasedManage",n).openManageAdaptationDialog()}function v(){return a.onGetOverview(true,this.getRtaInformation().flexSettings.layer)}function w(){return a.onGetOverview(false,this.getRtaInformation().flexSettings.layer)}function I(){a.onGetOverview(true,this.getRtaInformation().flexSettings.layer)}l.prototype.getControl=function(t){var i=sap.ui.getCore().byId(this.getId()+"_fragment--sapUiRta_"+t);if(!i&&this._oActionsMenuFragment){i=sap.ui.getCore().byId(this._oActionsMenuFragment.getId().replace("sapUiRta_actions","sapUiRta_")+t)}return i};l.prototype.hide=function(){this._aIntersectionObservers.forEach(function(t){t.disconnect()});return h.prototype.hide.apply(this,arguments)};return l});
//# sourceMappingURL=Adaptation.js.map