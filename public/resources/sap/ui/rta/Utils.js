/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/write/api/FieldExtensibility","sap/ui/fl/Utils","sap/ui/fl/Layer","sap/ui/fl/LayerUtils","sap/ui/dt/OverlayUtil","sap/ui/dt/DOMUtil","sap/ui/dt/ElementUtil","sap/ui/dt/MetadataPropagationUtil","sap/ui/rta/util/hasStableId","sap/m/MessageBox","sap/ui/rta/util/BindingsExtractor","sap/base/util/restricted/_omit","sap/ui/model/json/JSONModel","sap/ui/core/Fragment","sap/ui/core/Core"],function(e,t,n,r,i,a,l,o,s,u,c,g,d,f,v){"use strict";var y={};y.RESOLVED_PROMISE=Promise.resolve(true);y._sFocusableOverlayClass=".sapUiDtOverlaySelectable";y._sRtaStyleClassName="";y.getRtaStyleClassName=function(){return y._sRtaStyleClassName};y.setRtaStyleClassName=function(e){if(e===n.USER){y._sRtaStyleClassName=""}else if(r.getLayerIndex(e)>-1){y._sRtaStyleClassName="sapUiRTABorder"}};y.isServiceUpToDate=function(t){return e.isExtensibilityEnabled(t).then(function(n){if(n){var r=t.getModel();if(r&&r.sServiceUrl){return e.isServiceOutdated(r.sServiceUrl).then(function(t){if(t){e.setServiceValid(r.sServiceUrl);v.getEventBus().publish("sap.ui.core.UnrecoverableClientStateCorruption","RequestReload",{})}})}}return undefined})};y.openRemoveConfirmationDialog=function(e,t){var n=v.getLibraryResourceBundle("sap.ui.rta");var r;return new Promise(function(e){r=n.getText("CTX_REMOVE_TITLE");var i={messageText:t,titleText:r,icon:"sap-icon://question-mark",removeText:n.getText("BTN_FREP_REMOVE"),cancelText:n.getText("BTN_FREP_CANCEL")};var a=new d;a.setData(i);var l;var o=function(){if(l){l.close();l.destroy();l=null}};var s={removeField:function(){o();e(true)},closeDialog:function(){o();e(false)}};if(!l){f.load({name:"sap.ui.rta.view.RemoveElementDialog",controller:s}).then(function(e){l=e;l.setModel(a);l.addStyleClass(y.getRtaStyleClassName());l.open()})}else{l.addStyleClass(y.getRtaStyleClassName());l.open()}})};y.isOverlaySelectable=function(e){return e.isSelectable()&&a.isVisible(e.getDomRef())};y.getPropertyValue=function(e,t){var n=e.getMetadata().getPropertyLikeSetting(t);var r=n._sGetter;return e[r]()};y.getOverlayInstanceForDom=function(e){var t=e.getAttribute("id");if(t){return v.byId(t)}return undefined};y.getFocusedOverlay=function(){if(document.activeElement){var e=v.byId(document.activeElement.id);if(e&&e.isA("sap.ui.dt.ElementOverlay")){return e}}return undefined};y.getFocusableParentOverlay=function(e){if(!e){return undefined}var t=e.getParentElementOverlay();while(t&&!t.getSelectable()){t=t.getParentElementOverlay()}return t};y.getFirstFocusableDescendantOverlay=function(e){return i.getFirstDescendantByCondition(e,this.isOverlaySelectable)};y.getLastFocusableDescendantOverlay=function(e){return i.getLastDescendantByCondition(e,this.isOverlaySelectable)};y.getNextFocusableSiblingOverlay=function(e){var t=true;var n=i.getNextSiblingOverlay(e);while(n&&!this.isOverlaySelectable(n)){n=i.getNextSiblingOverlay(n)}if(!n){n=this._findSiblingOverlay(e,t)}return n};y.getPreviousFocusableSiblingOverlay=function(e){var t=false;var n=i.getPreviousSiblingOverlay(e);while(n&&!this.isOverlaySelectable(n)){n=i.getPreviousSiblingOverlay(n)}if(!n){n=this._findSiblingOverlay(e,t)}return n};y._findSiblingOverlay=function(e,t){var n=e.getParentElementOverlay();if(n){var r=t?i.getNextSiblingOverlay(n):i.getPreviousSiblingOverlay(n);if(!r){return this._findSiblingOverlay(n,t)}var a=t?this.getFirstFocusableDescendantOverlay(r):this.getLastFocusableDescendantOverlay(r);return a}return undefined};y.getIndex=function(e,t,n,r){var i;if(r&&typeof r==="function"){i=r(e,t)}else{var a=e.getMetadata();var l=a.getAggregation(n);var o=l._sGetter;var s=e[o]();if(Array.isArray(s)&&t){i=s.indexOf(t)+1}else{i=0}}return i};y.createFieldLabelId=function(e,t,n){return(e.getId()+"_"+t+"_"+n).replace("/","_")};y.getElementBindingPaths=function(e){var t={};if(e.mBindingInfos){for(var n in e.mBindingInfos){var r=e.mBindingInfos[n].parts[0].path?e.mBindingInfos[n].parts[0].path:"";r=r.split("/")[r.split("/").length-1];t[r]={valueProperty:n}}}return t};y.isOriginalFioriToolbarAccessible=function(){var e=y.getFiori2Renderer();return e&&e.getRootControl&&e.getRootControl().getOUnifiedShell().getHeader()};y.getFiori2Renderer=function(){var e=t.getUshellContainer()||{};return typeof e.getRenderer==="function"?e.getRenderer("fiori2"):undefined};y.extendWith=function(e,t,n){if(!(typeof n==="function")){throw new Error("In order to use extendWith() utility function fnCustomizer should be provided!")}for(var r in t){if(t.hasOwnProperty(r)){if(n(e[r],t[r],r,e,t)){e[r]=t[r]}}}};y.isElementInViewport=function(e){e=e.jquery?e.get(0):e;var t=e.getBoundingClientRect();return t.top>=0&&t.left>=0&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&t.right<=(window.innerWidth||document.documentElement.clientWidth)};y.showMessageBox=function(e,t,n){return v.getLibraryResourceBundle("sap.ui.rta",true).then(function(r){n=n||{};var i=r.getText(t,n.error?[n.error.userMessage||n.error.message||n.error]:undefined);var a=n.titleKey&&r.getText(n.titleKey);var l=n.actionKeys&&n.actionKeys.map(function(e){return r.getText(e)});var o=n.emphasizedActionKey?r.getText(n.emphasizedActionKey):undefined;var s=n.showCancel;var c=g(n,["titleKey","error","actionKeys","emphasizedAction","emphasizedActionKey","showCancel"]);c.title=a;c.styleClass=y.getRtaStyleClassName();c.actions=c.actions||l;c.emphasizedAction=o||n.emphasizedAction;if(s){c.actions.push(u.Action.CANCEL)}return m(e,i,c)})};function m(e,t,n){return new Promise(function(r){n.onClose=r;u[e](t,n)})}y.checkSourceTargetBindingCompatibility=function(e,t,n){n=n||e.getModel();var r=c.collectBindingPaths(e,n);var i;var a;if(r.bindingPaths.length===0){return true}i=c.getBindingContextPath(e);a=c.getBindingContextPath(t);if(i===a){return true}return false};y.doIfAllControlsAreAvailable=function(e,t){if(e.every(function(e){return e&&!e._bIsBeingDestroyed})){return t()}return undefined};y.buildHashMapFromArray=function(e,t,n){return e.reduce(function(e,r){e[r[t]]=r[n];return e},{})};y.checkTargetZone=function(e,t,n,r){function i(e,t,n,r){var i=e.getDesignTimeMetadata();var a=i.getAction("move",t);if(!a){return Promise.resolve(false)}return r.hasChangeHandler(a.changeType,n)}return l.checkTargetZone(e,t,r).then(function(r){if(!r){return false}var a=t.getElement();var l=e.getParent();var u=t.getRelevantContainer();if(!a||!l){return false}var c=l.getElement();var g=e.getDesignTimeMetadata();var d=o.getRelevantContainerForPropagation(g.getData(),a);d=d||c;if(!u||!d||!s(l)||u!==d){return false}if(t.getParent().getElement()!==c&&!y.checkSourceTargetBindingCompatibility(a,c)){return false}return i(e,a,d,n)})};return y},true);
//# sourceMappingURL=Utils.js.map