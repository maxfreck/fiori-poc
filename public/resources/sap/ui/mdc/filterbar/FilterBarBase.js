/*!
 * OpenUI5
 * (c) Copyright 2009-2023 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/mdc/p13n/subcontroller/FilterController","sap/ui/core/library","sap/ui/core/ShortcutHintsMixin","sap/ui/Device","sap/ui/mdc/Control","sap/base/Log","sap/base/util/merge","sap/base/util/deepEqual","sap/ui/model/base/ManagedObjectModel","sap/ui/base/ManagedObjectObserver","sap/ui/mdc/condition/ConditionModel","sap/ui/mdc/condition/Condition","sap/ui/mdc/condition/ConditionConverter","sap/ui/mdc/util/IdentifierUtil","sap/ui/mdc/util/FilterUtil","sap/ui/mdc/filterbar/PropertyHelper","sap/ui/mdc/enum/ReasonMode","sap/ui/mdc/enum/FilterBarValidationStatus","sap/ui/fl/apply/api/ControlVariantApplyAPI","sap/m/library","sap/m/Button","./FilterBarBaseRenderer"],function(t,e,i,n,r,o,s,a,l,h,d,u,p,c,f,g,_,y,m,v,F,b){"use strict";var C=e.ValueState;var I=r.extend("sap.ui.mdc.filterbar.FilterBarBase",{metadata:{library:"sap.ui.mdc",designtime:"sap/ui/mdc/designtime/filterbar/FilterBarBase.designtime",defaultAggregation:"filterItems",interfaces:["sap.ui.mdc.IFilter","sap.ui.mdc.IxState"],properties:{delegate:{type:"object",defaultValue:{name:"sap/ui/mdc/FilterBarDelegate",payload:{modelName:undefined,collectionName:""}}},liveMode:{type:"boolean",defaultValue:false},showMessages:{type:"boolean",group:"Misc",defaultValue:true},showGoButton:{type:"boolean",defaultValue:true},filterConditions:{type:"object",defaultValue:{}},propertyInfo:{type:"object",defaultValue:[]},suspendSelection:{type:"boolean",defaultValue:false},_filterCount:{type:"string",visibility:"hidden"}},aggregations:{filterItems:{type:"sap.ui.mdc.FilterField",multiple:true},basicSearchField:{type:"sap.ui.mdc.FilterField",multiple:false},layout:{type:"sap.ui.mdc.filterbar.IFilterContainer",multiple:false,visibility:"hidden"}},associations:{variantBackreference:{type:"sap.ui.fl.variants.VariantManagement",multiple:false}},events:{search:{reason:{type:"sap.ui.mdc.enum.ReasonMode"}},filtersChanged:{parameters:{conditionsBased:{type:"boolean"},filtersText:{type:"string"},filtersTextExpanded:{type:"string"}}}}},renderer:b});var P=v.ButtonType;I.INNER_MODEL_NAME="$sap.ui.filterbar.mdc.FilterBarBase";I.CONDITION_MODEL_NAME="$filters";I.prototype.init=function(){r.prototype.init.apply(this,arguments);this._oRb=sap.ui.getCore().getLibraryResourceBundle("sap.ui.mdc");this._createInnerModel();this._oObserver=new h(this._observeChanges.bind(this));this._oObserver.observe(this,{aggregations:["filterItems","basicSearchField"]});this._createInnerLayout();this._bPersistValues=false;this.getEngine().register(this,{controller:{Filter:new t({control:this})}});this._fResolveInitialFiltersApplied=undefined;this._oInitialFiltersAppliedPromise=new Promise(function(t){this._fResolveInitialFiltersApplied=t}.bind(this));this._bIgnoreChanges=false;this._aOngoingChangeAppliance=[];this._bSearchTriggered=false;this._bIgnoreQueuing=false};I.prototype._createInnerLayout=function(){this._cLayoutItem=null;this._oFilterBarLayout=null;this._bPersistValues=false;this._btnAdapt=null;this.setAggregation("layout",this._oFilterBarLayout,true)};I.prototype._isPhone=function(){return n.system.phone?true:false};I.prototype._isLiveMode=function(){if(this._isPhone()){return false}return this.getLiveMode()};I.prototype._getConditionModel=function(){return this._oConditionModel};I.prototype._getSearchButton=function(){if(!this._btnSearch){this._btnSearch=new F(this.getId()+"-btnSearch",{text:this._oRb.getText("filterbar.GO"),press:this.onSearch.bind(this),type:P.Emphasized});i.addConfig(this._btnSearch,{addAccessibilityLabel:true,message:this._oRb.getText("filterbar.GoBtnShortCutHint")},this)}return this._btnSearch};I.prototype.getConditionModelName=function(){return this._getConditionModelName()};I.prototype._getConditionModelName=function(){return I.CONDITION_MODEL_NAME};I.prototype._createConditionModel=function(){this._oConditionModel=new d;this.setModel(this._oConditionModel,this._getConditionModelName())};I.prototype.applySettings=function(t,e){this._setPropertyHelperClass(g);this._setupPropertyInfoStore("propertyInfo");this._applySettings(t,e);Promise.all([this.awaitPropertyHelper()]).then(function(){if(!this._bIsBeingDestroyed){this._applyInitialFilterConditions()}}.bind(this))};I.prototype._applySettings=function(t,e){r.prototype.applySettings.apply(this,arguments);this._createConditionModel();this._oConditionModel.attachPropertyChange(this._handleConditionModelPropertyChange,this)};I.prototype._waitForMetadata=function(){return this._retrieveMetadata().then(function(){this._applyInitialFilterConditions()}.bind(this))};I.prototype.setIgnoreQueuing=function(t){this._bIgnoreQueuing=t};I.prototype.getIgnoreQueuing=function(){return this._bIgnoreQueuing};I.prototype.setSuspendSelection=function(t){this.setProperty("suspendSelection",t);if(!t){if(this._bSearchTriggered&&!this.getIgnoreQueuing()){this.triggerSearch()}this._bSearchTriggered=false;this.setIgnoreQueuing(false)}return this};I.prototype._createInnerModel=function(){this._oModel=new l(this);this.setModel(this._oModel,I.INNER_MODEL_NAME);return this};I.prototype.getCurrentState=function(){var t={};if(this._bPersistValues){t.filter=s({},this.getFilterConditions())}var e=this.getFilterItems();var i=[];e.forEach(function(t,e){i.push({name:t.getFieldPath()})});t.items=i;return t};I.prototype.getAssignedFilterNames=function(){var t,e=null,i=this._getConditionModel();if(i){e=[];var n=i.getConditions("$search");if(n&&n.length>0){e.push(this._oRb.getText("filterbar.ADAPT_SEARCHTERM"))}this._getNonHiddenPropertyInfoSet().forEach(function(n){t=c.getPropertyKey(n);var r=i.getConditions(t);if(r&&r.length>0){e.push(n.label||t)}})}return e};I.prototype._getAssignedFiltersText=function(){var t={};t.filtersText=this._getAssignedFiltersCollapsedText(this.getAssignedFilterNames());t.filtersTextExpanded=this._getAssignedFiltersExpandedText();return t};I.prototype._getAssignedFiltersExpandedText=function(){var t=0,e=0,i=this._getConditionModel();if(i){var n=i.getAllConditions();for(var r in n){var o=this._getPropertyByName(r);if(o&&!o.hiddenFilter&&n[r].length>0){++t;if(!(r==="$search"&&this.getAggregation("basicSearchField")||this._getFilterField(r))){++e}}}}if(!t&&!e){return this._oRb.getText("filterbar.ADAPT_NOTFILTERED")}if(!e){if(t===1){return this._oRb.getText("filterbar.ADAPT_FILTER_WITH_NON_HIDDEN",[t])}return this._oRb.getText("filterbar.ADAPT_FILTERS_WITH_NON_HIDDEN",[t])}if(t===1){return this._oRb.getText("filterbar.ADAPT_FILTER_WITH_HIDDEN",[t,e])}return this._oRb.getText("filterbar.ADAPT_FILTERS_WITH_HIDDEN",[t,e])};I.prototype._getAssignedFiltersCollapsedText=function(t){var e;t=t||[];if(t.length){e=Object.keys(t).map(function(e){return t[e]}).join(", ");if(t.length===1){return this._oRb.getText("filterbar.ADAPT_FILTER_COLLAPSED",[t.length,e])}return this._oRb.getText("filterbar.ADAPT_FILTERS_COLLAPSED",[t.length,e])}return this._oRb.getText("filterbar.ADAPT_NOTFILTERED")};I.prototype.getAssignedFiltersText=function(){return this._getAssignedFiltersText()};I.prototype._reportModelChange=function(t){if(t.triggerFilterUpdate){this._handleAssignedFilterNames(false)}if(this.getLiveMode()||t.triggerSearch||this._bExecuteOnSelect){this._bExecuteOnSelect=false;this.triggerSearch()}else if(t.recheckMissingRequired){this._recheckMissingRequiredFields()}};I.prototype.getPropertyInfoSet=function(){return this.getPropertyHelper()?this.getPropertyHelper().getProperties():[]};I.prototype._addConditionChange=function(t){this._aOngoingChangeAppliance.push(this.getEngine().createChanges({control:this,applySequentially:true,applyAbsolute:true,key:"Filter",state:t}))};I.prototype._handleConditionModelPropertyChange=function(t){var e;var i=function(t,e){var i={};i[t]=this._stringifyConditions(t,s([],e));this._cleanupConditions(i[t]);return i}.bind(this);if(!this._bIgnoreChanges){var n=t.getParameter("path");if(n.indexOf("/conditions/")===0){var r=n.substring("/conditions/".length);if(this._bPersistValues){var o=t.getParameter("value");if(this._getPropertyByName(r)){e=i(r,o)}else{e=this._retrieveMetadata().then(function(){return i(r,o)})}}else{this._reportModelChange({triggerSearch:false,triggerFilterUpdate:true})}}}if(e){this._addConditionChange(e)}};I.prototype._toExternal=function(t,e){var i=s({},e);i=p.toString(i,t.typeConfig.typeInstance,this.getTypeUtil());this._cleanupCondition(i);this._convertInOutParameters(e,i,"inParameters",p.toString);this._convertInOutParameters(e,i,"outParameters",p.toString);return i};I.prototype._toInternal=function(t,e){var i=s({},e);i=p.toType(i,t.typeConfig.typeInstance,this.getTypeUtil());this._convertInOutParameters(e,i,"inParameters",p.toType);this._convertInOutParameters(e,i,"outParameters",p.toType);return i};I.prototype._convertInOutParameters=function(t,e,i,n){if(t[i]&&Object.keys(t[i]).length>0){Object.keys(t[i]).forEach(function(r){var s=r.startsWith("conditions/")?r.slice(11):r;var a=this._getPropertyByName(s);if(a){var l=u.createCondition("EQ",[t[i][r]]);var h=n(l,a.typeConfig.typeInstance,this.getTypeUtil());if(!e[i]){e[i]={}}if(!r.startsWith("conditions/")){delete e[i][r];r="conditions/"+s}e[i][r]=h.values[0]}else{o.error("mdc.FilterBar._convertInOutParameters: could not find property info for "+s)}}.bind(this))}};I.prototype._cleanupCondition=function(t){if(t){if(t.hasOwnProperty("isEmpty")){delete t.isEmpty}}};I.prototype._cleanupConditions=function(t){if(t){t.forEach(function(t){this._cleanupCondition(t)},this)}};I.prototype._stringifyCondition=function(t,e){var i=e;if(e&&e.values){if(e.values.length>0){i=this._toExternal(t,e)}else{i=s({},e);this._cleanupCondition(i)}}return i};I.prototype._stringifyConditions=function(t,e){var i=this._getPropertyByName(t);var n=e;if(i&&e){n=[];e.forEach(function(t){n.push(this._stringifyCondition(i,t))},this)}return n};I.prototype._internalizeConditions=function(t){var e=s({},t);Object.keys(e).forEach(function(t){e[t].forEach(function(i,n){var r=this._getPropertyByName(t);e[t][n]=this._toInternal(r,i)},this)},this);return e};I.prototype._handleAssignedFilterNames=function(t){if(this._bIsBeingDestroyed){return}if(!t){if(this._btnAdapt){var e=this.getAssignedFilterNames();this.setProperty("_filterCount",this._oRb.getText(e.length?"filterbar.ADAPT_NONZERO":"filterbar.ADAPT",e.length),false)}}var i=this._getAssignedFiltersText();var n={conditionsBased:!t&&!this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch,filtersText:i.filtersText,filtersTextExpanded:i.filtersTextExpanded};this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=false;this.fireFiltersChanged(n)};I.prototype.onReset=function(t){this._getConditionModel().oConditionModel.removeAllConditions()};I.prototype.onSearch=function(t){if(!this._bSearchPressed){this._bSearchPressed=true;this._sReason=_.Go;this.triggerSearch().then(function(){this._bSearchPressed=false}.bind(this),function(){this._bSearchPressed=false}.bind(this))}};I.prototype.triggerSearch=function(){if(this.getSuspendSelection()){this._bSearchTriggered=true;return Promise.resolve()}return this.validate()};I.prototype._hasRetrieveMetadataToBeCalled=function(){return this.getPropertyHelper()===null||this.getPropertyHelper().getProperties().length===0&&!this.isPropertyHelperFinal()};I.prototype.validate=function(t){var e=!t;var i=function(){if(!this._oValidationPromise){this._oValidationPromise=new Promise(function(t,e){this._fResolvedSearchPromise=t;this._fRejectedSearchPromise=e}.bind(this));var t=function(){this._validate(e)};setTimeout(t.bind(this),0)}return this._oValidationPromise}.bind(this);return this.waitForInitialization().then(function(){if(this._hasRetrieveMetadataToBeCalled()){return this._retrieveMetadata().then(function(){return i()})}else{return i()}}.bind(this))};I.prototype._clearDelayedSearch=function(){if(this._iDelayedSearchId){clearTimeout(this._iDelayedSearchId);this._iDelayedSearchId=null}};I.prototype._checkAsyncValidation=function(){var t=y.NoError;if(this._aFIChanges&&this._aFIChanges.length>0){t=y.AsyncValidation}return t};I.prototype._checkOngoingChangeAppliance=function(){var t=y.NoError;if(this._aOngoingChangeAppliance&&this._aOngoingChangeAppliance.length>0){t=y.OngoingChangeAppliance}return t};I.prototype._recheckMissingRequiredFields=function(){this.getFilterItems().forEach(function(t){var e;if(t){if(t.getValueState()!==C.None&&t.getValueStateText()===this._oRb.getText("filterbar.REQUIRED_FILTER_VALUE_MISSING")){if(!e){e=f.getRequiredFieldNamesWithoutValues(this)}if(e.indexOf(t.getFieldPath())<0){t.setValueState(C.None)}}}}.bind(this))};I.prototype._checkRequiredFields=function(){var t=y.NoError;var e=f.getRequiredFieldNamesWithoutValues(this);e.forEach(function(e){var i=this._getFilterField(e);if(i){if(i.getValueState()===C.None){i.setValueState(C.Error);i.setValueStateText(this._oRb.getText("filterbar.REQUIRED_FILTER_VALUE_MISSING"))}}else{o.error("Mandatory filter field '"+e+"' not visible on FilterBarBase has no value.")}t=y.RequiredHasNoValue}.bind(this));return t};I.prototype._checkFieldsInErrorState=function(){var t=y.NoError;this.getFilterItems().some(function(e){if(e&&e.getValueState()!==C.None){if(e.getValueStateText()!==this._oRb.getText("filterbar.REQUIRED_FILTER_VALUE_MISSING")){t=y.FieldInErrorState}}return t!==y.NoError}.bind(this));return t};I.prototype._handleFilterItemSubmit=function(t){var e=t.getParameter("promise");if(e){this._sReason=_.Enter;e.then(function(){var t=this._aOngoingChangeAppliance&&this._aOngoingChangeAppliance.length>0?this._aOngoingChangeAppliance.slice():[Promise.resolve()];Promise.all(t).then(function(){this.triggerSearch()}.bind(this))}.bind(this)).catch(function(t){o.error(t);this.triggerSearch().catch(function(t){})}.bind(this))}};I.prototype._handleFilterItemChanges=function(t){if(this._bIgnoreChanges){return}var e=t.oSource;if(e.getRequired()&&e.getValueState()===C.Error&&t.getParameter("valid")){e.setValueState(C.None);return}if(!this._aFIChanges){this._aFIChanges=[]}this._aFIChanges.push({name:e.getFieldPath(),promise:t.getParameter("promise")})};I.prototype.checkFilters=function(){var t=this._checkAsyncValidation();if(t!==y.NoError){return t}t=this._checkOngoingChangeAppliance();if(t!==y.NoError){return t}t=this._checkFieldsInErrorState();if(t!==y.NoError){return t}t=this._checkRequiredFields();if(t!==y.NoError){return t}return t};I.prototype._setFocusOnFirstErroneousField=function(){var t=null;this.getFilterItems().some(function(e){if(e.getValueState()!==C.None){t=e;setTimeout(e["focus"].bind(e),0)}return t!=null});return t};I.prototype._handleAsyncValidation=function(t,e){if(!e){e=this._validate.bind(this)}if(this._aFIChanges&&this._aFIChanges.length>0){var i=this._aFIChanges.slice();this._aFIChanges=null;var n=[];i.forEach(function(t){n.push(t.promise)});Promise.all(n).then(function(n){n.forEach(function(t,e){var n=this._getFilterField(i[e].name);if(n&&n.getRequired()&&n.getValueState()===C.Error){n.setValueState(C.None)}},this);e(t)}.bind(this)).catch(function(i){e(t)})}};I.prototype._handleOngoingChangeAppliance=function(t,e){if(!e){e=this._validate.bind(this)}if(this._aOngoingChangeAppliance&&this._aOngoingChangeAppliance.length>0){var i=this._aOngoingChangeAppliance.slice();this._aOngoingChangeAppliance=[];if(this._oApplyingChanges){i.push(this._oApplyingChanges)}Promise.all(i).then(function(){e(t)}).catch(function(i){e(t)})}};I.prototype._determineValidationState=function(){return this.awaitControlDelegate().then(function(t){return t.determineValidationState(this,this.checkFilters())}.bind(this))};I.prototype._visualizeValidationState=function(t){if(this._oDelegate){this._oDelegate.visualizeValidationState(this,{status:t})}};I.prototype.getText=function(t){return this._oRb.getText(t)};I.prototype._restartCheckAndNotify=function(t){var e=this.checkFilters();this._checkAndNotify(t,e)};I.prototype._checkAndNotify=function(t,e){var i=function(){if(t){var e={reason:this._sReason?this._sReason:_.Unclear};this._sReason=_.Unclear;this.fireSearch(e)}}.bind(this);var n=function(){this._oValidationPromise=null;this._fRejectedSearchPromise=null;this._fResolvedSearchPromise=null}.bind(this);if(e===y.AsyncValidation){this._handleAsyncValidation(t,this._restartCheckAndNotify.bind(this));return}if(e===y.OngoingChangeAppliance){this._handleOngoingChangeAppliance(t,this._restartCheckAndNotify.bind(this));return}if(e===y.NoError){if(this._fResolvedSearchPromise){i();this._fResolvedSearchPromise()}}else if(this._fRejectedSearchPromise){this._fRejectedSearchPromise()}this._visualizeValidationState(e);n()};I.prototype._validate=function(t){var e=function(){this._oValidationPromise=null;this._fRejectedSearchPromise=null;this._fResolvedSearchPromise=null}.bind(this);if(this.bIsDestroyed){e();return}this._determineValidationState().then(function(e){this._checkAndNotify(t,e)}.bind(this))};I.prototype.setInternalConditions=function(t){var e=this._getConditionModel();if(e){e.setConditions(t)}};I.prototype.getInternalConditions=function(){return this._getModelConditions(this._getConditionModel(),true)};I.prototype.waitForInitialization=function(){return Promise.all([this._oInitialFiltersAppliedPromise,this._oMetadataAppliedPromise])};I.prototype.initialized=function(){return this.waitForInitialization()};I.prototype.initializedWithMetadata=function(){if(!this._oMetadataAppliedPromise){this._retrieveMetadata()}return this.waitForInitialization()};I.prototype._getModelConditions=function(t,e,i){var n={};if(t){var r=s({},t.getAllConditions());for(var o in r){if(r[o]&&(i||r[o].length>0)){n[o]=r[o];if(!e){this._cleanupConditions(n[o]);var a=this._stringifyConditions(o,n[o]);n[o]=a}}}}return n};var S=function(t){var e=t.typeConfig.typeInstance;var i=e.getConstraints();return e.getMetadata().getName()==="sap.ui.model.odata.type.String"&&i&&i.isDigitSequence&&i.maxLength?function(e){return this._toExternal(t,e,this.getTypeUtil())}.bind(this):undefined};I.prototype._isPathKnownAsync=function(t,e){var i,n,r=[];r.push(this._getPropertyByNameAsync(t));for(n in e["inParameters"]){i=n.startsWith("conditions/")?n.slice(11):n;r.push(this._getPropertyByNameAsync(i))}for(n in e["outParameters"]){i=n.startsWith("conditions/")?n.slice(11):n;r.push(this._getPropertyByNameAsync(i))}return Promise.all(r)};I.prototype._isPathKnown=function(t,e){var i,n;if(!this._getPropertyByName(t)){return false}for(i in e["inParameters"]){n=i.startsWith("conditions/")?i.slice(11):i;if(!this._getPropertyByName(n)){return false}}for(i in e["outParameters"]){n=i.startsWith("conditions/")?i.slice(11):i;if(!this._getPropertyByName(n)){return false}}return true};I.prototype._removeCondition=function(t,e,i){var n=this._getPropertyByName(t);if(n){var r=this._toInternal(n,e);if(i.indexOf(t,r,S.call(this,n))>=0){i.removeCondition(t,r)}}};I.prototype.removeCondition=function(t,e){return this.waitForInitialization().then(function(){var i=this._getConditionModel();if(i){this._isPathKnownAsync(t,e).then(function(){this._removeCondition(t,e,i)}.bind(this))}}.bind(this))};I.prototype._addCondition=function(e,i,n){var r=this._getPropertyByName(e);if(r){var o=this._toInternal(r,i);if(n.indexOf(e,o,S.call(this,r))<0){var s={};s[e]=[o];t.checkConditionOperatorSanity(s);var a=s[e];if(a&&a.length>0){this._cleanUpFilterFieldInErrorStateByName(e);n.addCondition(e,o)}}}};I.prototype.addCondition=function(t,e){return this.waitForInitialization().then(function(){var i=this._getConditionModel();if(i){this._isPathKnownAsync(t,e).then(function(){this._addCondition(t,e,i)}.bind(this))}}.bind(this))};I.prototype._onModifications=function(t){if(t&&t.indexOf("Filter")===-1){return Promise.resolve()}var e;if(!this._oApplyingChanges){this._oApplyingChanges=new Promise(function(t){e=t})}return this._setXConditions(this.getFilterConditions()).then(function(){this._reportModelChange({triggerSearch:false,triggerFilterUpdate:true,recheckMissingRequired:true});e();this._oApplyingChanges=null}.bind(this))};I.prototype._setXConditions=function(t){if(t){var e=true;for(var i in t){var n=t[i];if(!this._isPathKnown(i,n)){e=false;break}}var r=e?Promise.resolve():this._retrieveMetadata();var o=this._getConditionModel();return r.then(function(){var e=this._internalizeConditions(t);var i=this._getModelConditions(this._getConditionModel(),true);this._oConditionModel.detachPropertyChange(this._handleConditionModelPropertyChange,this);return this.getEngine().diffState(this,{Filter:i},{Filter:e}).then(function(t){Object.keys(t.Filter).forEach(function(e){t.Filter[e].forEach(function(t){if(t.filtered!==false){o.addCondition(e,t)}else{o.removeCondition(e,t)}})});o.attachPropertyChange(this._handleConditionModelPropertyChange,this)}.bind(this))}.bind(this))}else{return Promise.resolve()}};I.prototype._getXConditions=function(){return this._getModelConditions(this._getConditionModel(),false)};I.prototype._getRequiredPropertyNames=function(){var t=[];this._getNonHiddenPropertyInfoSet().forEach(function(e){if(e.required){t.push(c.getPropertyKey(e))}});return t};I.prototype._getNonRequiredPropertyNames=function(){var t=[];this._getNonHiddenPropertyInfoSet().forEach(function(e){if(!e.required){t.push(c.getPropertyKey(e))}});return t};I.prototype._insertFilterFieldtoContent=function(t,e){if(!this._cLayoutItem){return}var i=this._cLayoutItem;var n=new i;n.setFilterField(t);this._oFilterBarLayout.insertFilterField(n,e)};I.prototype._filterItemInserted=function(t){if(!t.getVisible()){return}if(t.setWidth){t.setWidth("")}this._applyFilterItemInserted(t);this._handleAssignedFilterNames(true)};I.prototype._applyFilterItemInserted=function(t){var e,i;i=this.indexOfAggregation("filterItems",t);if(this.getAggregation("basicSearchField")){i++}e=i;var n=this.getFilterItems();for(var r=0;r<e;r++){if(!n[r].getVisible()){i--}}this._insertFilterFieldtoContent(t,i);if(!this._oObserver.isObserved(t,{properties:["visible"]})){this._oObserver.observe(t,{properties:["visible"]})}};I.prototype._filterItemRemoved=function(t){this._applyFilterItemRemoved(t.getFieldPath());this._handleAssignedFilterNames(true)};I.prototype._applyFilterItemRemoved=function(t){this._removeFilterFieldFromContentByName(t)};I.prototype._removeFilterFieldFromContent=function(t){this._removeFilterFieldFromContentByName(t.getFieldPath())};I.prototype._removeFilterFieldFromContentByName=function(t){var e=this._getFilterItemLayoutByName(t);if(e){this._oFilterBarLayout.removeFilterField(e);e.destroy()}};I.prototype._observeChanges=function(t){if(t.type==="aggregation"){if(t.name==="filterItems"){switch(t.mutation){case"insert":t.child.attachChange(this._handleFilterItemChanges,this);t.child.attachSubmit(this._handleFilterItemSubmit,this);this._filterItemInserted(t.child);break;case"remove":t.child.detachChange(this._handleFilterItemChanges,this);t.child.detachSubmit(this._handleFilterItemSubmit,this);this._filterItemRemoved(t.child);break;default:o.error("operation "+t.mutation+" not yet implemented")}}else if(t.name==="basicSearchField"){switch(t.mutation){case"insert":t.child.attachSubmit(this._handleFilterItemSubmit,this);this._insertFilterFieldtoContent(t.child,0);break;case"remove":t.child.detachSubmit(this._handleFilterItemSubmit,this);this._removeFilterFieldFromContent(t.child);break;default:o.error("operation "+t.mutation+" not yet implemented")}}}else if(t.type==="property"){var e;if(t.object.isA&&t.object.isA("sap.ui.mdc.FilterField")){e=t.object;if(e){if(t.current){this._filterItemInserted(e)}else{this._filterItemRemoved(e)}this._oFilterBarLayout.invalidate()}}}};I.prototype._getFilterItemLayout=function(t){return this._getFilterItemLayoutByName(t.getFieldPath())};I.prototype._getFilterItemLayoutByName=function(t){var e=null;if(this._oFilterBarLayout){this._oFilterBarLayout.getFilterFields().some(function(i){if(i._getFieldPath()===t){e=i}return e!==null})}return e};I.prototype._getFilterField=function(t){var e=null;this.getFilterItems().some(function(i){if(i&&i.getFieldPath&&i.getFieldPath()===t){e=i}return e!==null});return e};I.prototype._retrieveMetadata=function(){if(this._oMetadataAppliedPromise){return this._oMetadataAppliedPromise}this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=new Promise(function(t,e){this._fResolveMetadataApplied=t;this._fRejectMetadataApplied=e}.bind(this));this.initControlDelegate().then(function(){if(!this._bIsBeingDestroyed){var t=function(t){t?this._fResolveMetadataApplied():this._fRejectMetadataApplied();this._fResolveMetadataApplied=null;this._fRejectMetadataApplied=null}.bind(this);if(this.isControlDelegateInitialized()){this.finalizePropertyHelper().then(function(){t(true)})}else{o.error("Delegate not initialized.");t(false)}}}.bind(this));return this._oMetadataAppliedPromise};I.prototype.setBasicSearchField=function(t){var e=this.getAggregation("basicSearchField");if(e){this.removeAggregation("basicSearchField",e)}this.setAggregation("basicSearchField",t);if(t){if(!this._oObserver.isObserved(t,{properties:["visible"]})){this._oObserver.observe(t,{properties:["visible"]})}}return this};I.prototype._getNonHiddenPropertyInfoSet=function(){var t=[];this.getPropertyInfoSet().every(function(e){if(!e.hiddenFilter){if(c.getPropertyKey(e)!=="$search"){t.push(e)}}return true});return t};I.prototype._getNonHiddenPropertyByName=function(t){var e=null;this._getNonHiddenPropertyInfoSet().some(function(i){if(c.getPropertyKey(i)===t){e=i}return e!=null});return e};I.prototype._cleanUpFilterFieldInErrorStateByName=function(t){var e=null;var i=this.getFilterItems();i.some(function(i){if(i.getFieldPath()===t){e=i}return e!=null});if(e){this._cleanUpFilterFieldInErrorState(e)}};I.prototype._cleanUpAllFilterFieldsInErrorState=function(){this._getConditionModel().checkUpdate(true);var t=this.getFilterItems();t.forEach(function(t){this._cleanUpFilterFieldInErrorState(t)}.bind(this))};I.prototype._cleanUpFilterFieldInErrorState=function(t){if(t&&t.getValueState()!==C.None){t.setValueState(C.None)}};I.prototype._applyInitialFilterConditions=function(){this._bIgnoreChanges=true;this._applyFilterConditionsChanges().then(function(){this._bIgnoreChanges=false;this._reportModelChange({triggerFilterUpdate:true,triggerSearch:false});this._bInitialFiltersApplied=true;this._fResolveInitialFiltersApplied();this._fResolveInitialFiltersApplied=null}.bind(this))};I.prototype._applyFilterConditionsChanges=function(){var t,e;t=this.getProperty("filterConditions");if(Object.keys(t).length>0){e=s({},t);return this._setXConditions(e)}return Promise.resolve()};I.prototype.setVariantBackreference=function(t){if(!this._hasAssignedVariantManagement()){this.setAssociation("variantBackreference",t);m.attachVariantApplied({selector:this,vmControlId:this.getVariantBackreference(),callback:this._handleVariantSwitch.bind(this),callAfterInitialVariant:true})}else{o.error("the association 'variant' may only be assigned once and may not change afterwards.")}};I.prototype._handleVariantSwitch=function(t){this._bExecuteOnSelect=this._getExecuteOnSelectionOnVariant(t);this._sReason=this._bExecuteOnSelect?_.Variant:_.Unclear;this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=false;if(t.hasOwnProperty("createScenario")&&t.createScenario==="saveAs"){this._bDoNotTriggerFiltersChangeEventBasedOnVariantSwitch=true}return this.awaitPendingModification().then(function(t){this._cleanUpAllFilterFieldsInErrorState();if(this._bInitialFiltersApplied&&t.indexOf("Filter")===-1){this._reportModelChange({triggerFilterUpdate:false,triggerSearch:this._bExecuteOnSelect})}}.bind(this))};I.prototype._getExecuteOnSelectionOnVariant=function(t){var e=false,i=this._getAssignedVariantManagement();if(i){e=i.getApplyAutomaticallyOnVariant(t)}return e};I.prototype._hasAssignedVariantManagement=function(){return this._getAssignedVariantManagement()?true:false};I.prototype._getAssignedVariantManagement=function(){var t=this.getVariantBackreference();if(t){var e=sap.ui.getCore().byId(t);if(e&&e.isA("sap.ui.fl.variants.VariantManagement")){return e}}return null};I.prototype._getView=function(){return c.getView(this)};I.prototype.getConditions=function(){var t=this._bPersistValues?this.getCurrentState().filter:this._getXConditions();if(t&&t["$search"]){delete t["$search"]}return t};I.prototype.getSearch=function(){var t=this._getConditionModel()?this._getConditionModel().getConditions("$search"):[];return t[0]?t[0].values[0]:""};I.prototype.exit=function(){if(this._hasAssignedVariantManagement()){m.detachVariantApplied({selector:this,vmControlId:this.getVariantBackreference()})}if(this.isControlDelegateInitialized()&&this.getControlDelegate().cleanup){this.getControlDelegate().cleanup(this)}r.prototype.exit.apply(this,arguments);this._clearDelayedSearch();this._oFilterBarLayout=null;this._cLayoutItem=null;this._btnAdapt=undefined;this._btnSearch=undefined;this._oRb=null;if(this._oModel){this._oModel.destroy();this._oModel=null}if(this._oConditionModel){this._oConditionModel.detachPropertyChange(this._handleConditionModelPropertyChange,this);this._oConditionModel.destroy();this._oConditionModel=null}this._oObserver.disconnect();this._oObserver=undefined;this._bPersistValues=null;this._oDelegate=null;this._oFlexPromise=null;this._fResolveMetadataApplied=undefined;this._oMetadataAppliedPromise=null;this._oInitialFiltersAppliedPromise=null;this._oValidationPromise=null;this._aBindings=null;this._aFIChanges=null;this._aOngoingChangeAppliance=null};return I});
//# sourceMappingURL=FilterBarBase.js.map